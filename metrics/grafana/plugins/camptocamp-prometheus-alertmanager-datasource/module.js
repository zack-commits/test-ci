define(["@grafana/data","@grafana/runtime","rxjs","react","@grafana/ui"],((e,t,r,n,i)=>(()=>{"use strict";var a={781:t=>{t.exports=e},531:e=>{e.exports=t},7:e=>{e.exports=i},959:e=>{e.exports=n},269:e=>{e.exports=r}},o={};function l(e){var t=o[e];if(void 0!==t)return t.exports;var r=o[e]={exports:{}};return a[e](r,r.exports,l),r.exports}l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var r in t)l.o(t,r)&&!l.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};l.r(s),l.d(s,{plugin:()=>P});var c=l(781),u=l(531),p=l(269);const d={active:!0,silenced:!1,inhibited:!1};function f(e,t,r,n,i,a,o){try{var l=e[a](o),s=l.value}catch(e){return void r(e)}l.done?t(s):Promise.resolve(s).then(n,i)}function h(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){f(a,n,i,o,l,"next",e)}function l(e){f(a,n,i,o,l,"throw",e)}o(void 0)}))}}function v(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class b extends c.DataSourceApi{query(e){var t=this;return h((function*(){const r=e.targets.map((r=>{if(r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){v(e,t,r[t])}))}return e}({},d,r),r.hide)return Promise.resolve(new c.MutableDataFrame);let n=[];return n.push("active="+(r.active?"true":"false")),n.push("silenced="+(r.silenced?"true":"false")),n.push("inhibited="+(r.inhibited?"true":"false")),void 0!==r.receiver&&r.receiver.length>0&&n.push(`receiver=${r.receiver}`),void 0!==r.filters&&r.filters.length>0&&(r.filters=(0,u.getTemplateSrv)().replace(r.filters,e.scopedVars,t.interpolateQueryExpr),r.filters.split(",").forEach((e=>{n.push(`filter=${encodeURIComponent(e)}`)}))),t.doRequest({url:`${t.url}/api/v2/alerts?${n.join("&")}`,method:"GET"}).then((e=>(0,p.lastValueFrom)(e))).then((e=>t.retrieveData(r,e)))}));return Promise.all(r).then((e=>({data:e})))}))()}doRequest(e){var t=this;return h((function*(){return e.withCredentials=t.withCredentials,e.headers=t.headers,(0,u.getBackendSrv)().fetch(e)}))()}testDatasource(){var e=this;return h((function*(){return e.doRequest({url:e.url,method:"GET"}).then((e=>(0,p.lastValueFrom)(e).then((e=>void 0!==e?e.ok?{status:"success",message:"Datasource is working",title:"Success"}:{status:"error",message:`Datasource is not working: ${e.data}`,title:"Error"}:{status:"error",message:"Unknown error in datasource",title:"Error"}))))}))()}buildDataFrame(e,t){const r=[{name:"Time",type:c.FieldType.time},{name:"SeverityValue",type:c.FieldType.number}];if(t.length>0){const e=t.map((e=>Object.keys(e.annotations))).flat(),n=t.map((e=>Object.keys(e.labels))).flat();[...new Set([...e,...n,"alertstatus","alertstatus_code"])].forEach((e=>{r.push({name:e,type:c.FieldType.string})}))}return new c.MutableDataFrame({refId:e,fields:r})}parseAlertAttributes(e,t){let r=4;switch(e.labels.severity){case"critical":r=1;break;case"warning":r=2;break;case"info":r=3}const n=[e.startsAt,r];return t.slice(2).forEach((t=>{n.push(e.annotations[t.name]||e.labels[t.name]||"")})),n}retrieveData(e,t){const r=this.buildDataFrame(e.refId,t.data);return t.data.forEach((e=>{const t=this.parseAlertAttributes(e,r.fields);r.appendRow(t)})),Promise.resolve(r)}interpolateQueryExpr(e=[],t){if(!t.multi&&!t.includeAll)return function(e){return"string"==typeof e?e.replace(/\\/g,"\\\\").replace(/'/g,"\\\\'"):e}(e);if("string"==typeof e)return m(e);const r=e.map((e=>m(e)));return 1===r.length?r[0]:"("+r.join("|")+")"}constructor(e){super(e),v(this,"url",void 0),v(this,"withCredentials",void 0),v(this,"headers",void 0),this.url=void 0===e.url?"":e.url,this.withCredentials=void 0!==e.withCredentials,this.headers={"Content-Type":"application/json"},"string"==typeof e.basicAuth&&e.basicAuth.length>0&&(this.headers.Authorization=e.basicAuth)}}function m(e){return"string"==typeof e?e.replace(/\\/g,"\\\\\\\\").replace(/[$^*{}\[\]\'+?()|]/g,"\\\\$&"):e}var g=l(959),y=l.n(g),w=l(7);function O(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){O(e,t,r[t])}))}return e}function j(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t.push.apply(t,r)}return t}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const P=new c.DataSourcePlugin(b).setConfigEditor((function(e){const{onOptionsChange:t,options:r}=e;return y().createElement("div",{className:"gf-form-group"},y().createElement(w.DataSourceHttpSettings,{defaultUrl:"http://localhost:8080",dataSourceConfig:r,showAccessOptions:!0,onChange:t}))})).setQueryEditor((function({query:e,onChange:t,onRunQuery:r}){const{receiver:n,filters:i,active:a,silenced:o,inhibited:l}=E({},d,e);return y().createElement("div",null,y().createElement(w.InlineFieldRow,null,y().createElement(w.InlineField,{label:"Receiver"},y().createElement(w.Input,{name:"Receiver input",onChange:n=>{t(j(E({},e),{receiver:n.target.value})),r()},value:n,width:10})),y().createElement(w.InlineField,{label:"Filters (comma separated key=value)"},y().createElement(w.Input,{name:"Filters input",onChange:n=>{t(j(E({},e),{filters:n.target.value})),r()},value:i,width:30}))),y().createElement(w.InlineFieldRow,null,y().createElement(w.InlineField,{label:"Active"},y().createElement(w.InlineSwitch,{value:a,onChange:()=>{e.active=!e.active,t(E({},e)),r()}})),y().createElement(w.InlineField,{label:"Silenced"},y().createElement(w.InlineSwitch,{value:o,onChange:()=>{e.silenced=!e.silenced,t(E({},e)),r()}})),y().createElement(w.InlineField,{label:"Inhibited"},y().createElement(w.InlineSwitch,{value:l,onChange:()=>{e.inhibited=!e.inhibited,t(E({},e)),r()}}))))}));return s})()));
//# sourceMappingURL=module.js.map